# https://github.com/evilmartians/lefthook
# Pre-commit hooks for EchoSphere

pre-commit:
  parallel: true
  commands:
    lint-web:
      glob: "apps/web/src/**/*.{ts,tsx}"
      run: pnpm --filter @echo-sphere/web lint --max-warnings=0

    lint-agent:
      glob: "apps/agent/**/*.py"
      root: "apps/agent/"
      run: uv run ruff check {staged_files}

    format-agent:
      glob: "apps/agent/**/*.py"
      root: "apps/agent/"
      run: uv run ruff format --check {staged_files}

    typecheck-agent:
      glob: "apps/agent/**/*.py"
      root: "apps/agent/"
      run: uv run mypy {staged_files}

pre-push:
  parallel: true
  commands:
    test-web:
      run: pnpm --filter @echo-sphere/web test --run

    test-agent:
      root: "apps/agent/"
      run: uv run pytest tests/unit -q